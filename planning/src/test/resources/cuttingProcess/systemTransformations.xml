<?xml version="1.0" encoding="UTF-8"?>
<systemTransformations xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../systemTransformations.xsd">
	<systemTransformation name="ELEMENT-CUT-CYLINDER-SURFACE">
		<systemTemplate>
			<objectTemplates>
				<objectTemplate id="ID-WORKPIECE">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-WORKPIECE" value="true" />
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LINK-IS-PART-OF" value="ID-CYLINDER-SURFACE" />
						<linkTemplate name="LINK-IS-REQUIREMENT-OF" value="ID-REQUIREMENT" />
					</linkTemplates>
				</objectTemplate>
				<objectTemplate id="ID-CYLINDER-SURFACE">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-CYLINDER-SURFACE" value="true" />
						<attributeTemplate name="ATTRIBUTE-DIAMETER" />
						<attributeTemplate name="ATTRIBUTE-HAS-DIAMETER-REQUIREMENT" value="false" />
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LINK-IS-PART-OF" value="ID-WORKPIECE" />
						<linkTemplate name="LINK-IS-DIAMETER-REQUIREMENT" value="null" />
					</linkTemplates>
				</objectTemplate>
				<objectTemplate id="ID-REQUIREMENT">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-REQUIREMENT" value="true"/>
						<attributeTemplate name="ATTRIBUTE-REQUIREMENT" />
						<attributeTemplate name="ATTRIBUTE-DIAMETER-REQUIREMENT-STATUS" value="false" />
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LINK-IS-REQUIREMENT-OF" value="ID-WORKPIECE" />
						<linkTemplate name="LINK-IS-DIAMETER-REQUIREMENT" value="null" />
					</linkTemplates>
				</objectTemplate>
			</objectTemplates>
		</systemTemplate>
		<transformations>
			<transformation type="attribute" objectId="ID-ROBOT" attributeName="ATTRIBUTE-DIAMETER-REQUIREMENT-STATUS" attributeValue="true" />
			<transformation type="link" objectId="ID-REQUIREMENT" linkName="LINK-IS-DIAMETER-REQUIREMENT" linkOldValue="null" linkNewValue="ID-CYLINDER-SURFACE" />
			<transformation type="link" objectId="ID-CYLINDER-SURFACE" linkName="LINK-IS-DIAMETER-REQUIREMENT" linkOldValue="null" linkNewValue="ID-REQUIREMENT" />
			<transformation type="attribute" objectId="ID-CYLINDER-SURFACE" attributeName="ATTRIBUTE-HAS-DIAMETER-REQUIREMENT" attributeValue="true" />
		</transformations>
			<action name="OPERATION_CUT_CYLINDER_SURFACE">
				<preConditionCheckers>
					<preConditionChecker>
						<script type="lua">
							<line n="1">local systemVariant = ...</line>
							<line n="2">local cylinderSurface_actual = systemVariant:getObjectByIdMatch('ID-CYLINDER-SURFACE')</line>
							<line n="3">local diameter = cylinderSurface_actual:getAttribute('ATTRIBUTE-DIAMETER'):getValueAsInteger()</line>
							<line n="4">local requirement_actual = systemVariant:getObjectByIdMatch('ID-REQUIREMENT')</line>
							<line n="5">local diameterRequired = requirement_actual:getAttribute('ATTRIBUTE-DIAMETER-REQUIREMENT'):getValueAsInteger()</line>
							<line n="6">return diameter > diameterRequired</line>
						</script>
					</preConditionChecker>
				</preConditionCheckers>
				<parameterUpdaters>
					<parameterUpdater>
						<script type="lua">
							<line n="1">local systemVariant = ...</line>
							<line n="2">local cylinderSurface_actual = systemVariant:getObjectByIdMatch('ID-CYLINDER-SURFACE')</line>
							<line n="3">local diameter = cylinderSurface_actual:getAttribute('ATTRIBUTE-DIAMETER'):getValueAsInteger()</line>
							<line n="4">local requirement_actual = systemVariant:getObjectByIdMatch('ID-REQUIREMENT')</line>
							<line n="5">local diameterRequired = requirement_actual:getAttribute('ATTRIBUTE-DIAMETER-REQUIREMENT'):getValueAsInteger()</line>
							<line n="6">local diameterDelta = diameter - diameterRequired</line>
							<line n="7">systemVariant:setActionParameter('PARAMETER-DIAMETER-DELTA', diameterDelta)</line>
							<line n="8">cylinderSurface_actual:getAttribute('ATTRIBUTE-DIAMETER'):setValue(diameterRequired)</line>
						</script>
					</parameterUpdater>
				</parameterUpdaters>
			</action>
	</systemTransformation>
	<systemTransformation name="ELEMENT-TRIM-CYLINDER-SURFACE" >
		<systemTemplate>
			<objectTemplates>
				<objectTemplate id="ID-WORKPIECE">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-WORKPIECE" value="true" />
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LINK-IS-PART-OF" value="ID-CYLINDER-SURFACE" />
						<linkTemplate name="LINK-IS-REQUIREMENET-OF" value="ID-REQUIREMENT" />
					</linkTemplates>
				</objectTemplate>
				<objectTemplate id="ID-CYLINDER-SURFACE">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-CYLINDER-SURFACE" value="true" />
						<attributeTemplate name="ATTRIBUTE-LENGTH" />
						<attributeTemplate name="ATTRIBUTE-HAS-LENGTH-REQUIREMENT" value="false" />
						<attributeTemplate name="ATTRIBUTE-HAS-DIAMETER-REQUIREMENT" value="true" />
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LINK-IS-PART-OF" value="ID-WORKPIECE" />
						<linkTemplate name="LINK-IS-LENGTH-REQUIREMENT" value="null" />
					</linkTemplates>
				</objectTemplate>
				<objectTemplate id="ID-REQUIREMENT">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-REQUIREMENT" value="true" />
						<attributeTemplate name="ATTRIBUTE-LENGTH-REQUIREMENT" />
						<attributeTemplate name="ATTRIBUTE-LENGTH-REQUIREMENT-STATUS" value="false" />
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LINK-IS-REQUIREMENT-OF" value="ID-WORKPIECE" />
						<linkTemplate name="LINK-IS-LENGTH-REQUIREMENT" value="null" />
					</linkTemplates>
				</objectTemplate>
			</objectTemplates>
		</systemTemplate>
		<transformations>
			<transformation type="attribute" objectId="ID-REQUIREMENT" attributeName="ATTRIBUTE-LENGTH-REQUIREMENT-STATUS" attributeValue="true"/>
			<transformation type="link" objectId="ID-REQUIREMENT" linkName="LINK-IS-LENGTH-REQUIREMENT" linkOldValue="null" linkNewValue="ID-CYLINDER-SURFACE" />
			<transformation type="link" objectId="ID-CYLINDER-SURFACE" linkName="LINK-IS-LENGTH-REQUIREMENT" linkOldValue="null" linkNewValue="ID-REQUIREMENT" />
			<transformation type="attribute" objectId="ID-CYLINDER-SURFACE" attributeName="ATTRIBUTE-HAS-LENGTH-REQUIREMENT" attributeValue="true" />
		</transformations>
		<action name="OPERATION-TRIM-CYLINDER-SURFACE">
			<preConditionCheckers>
				<preConditionChecker>
					<script type="lua">
						<line n="1">local systemVariant = ...</line>
						<line n="2">local cylinderSurface_actual = systemVariant:getObjectByIdMatch('ID-CYLINDER-SURFACE')</line>
						<line n="3">local length = cylinderSurface_actual:getAttribute('ATTRIBUTE-LENGTH'):getValueAsInteger()</line>
						<line n="4">local requirement_actual = systemVariant:getObjectByIdMatch('ID-REQUIREMENT')</line>
						<line n="5">local lengthRequired = requirement_actual:getAttribute('ATTRIBUTE-LENGTH-REQUIREMENT'):getValueAsInteger()</line>
						<line n="6">return length == lengthRequired</line>
					</script>
				</preConditionChecker>
			</preConditionCheckers>
		</action>
	</systemTransformation>
	<systemTransformation name="ELEMENT-SPLIT-CYLINDER-SURFACE">
		<systemTemplate>
			<objectTemplates>
				<objectTemplate id="ID-WORKPIECE">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-WORKPIECE" value="true"/>
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LINK-IS-PART-OF" value="ID-CYLINDER-SURFACE" />
						<linkTemplate name="LINK-IS-REQUIREMENT-OF" value="ID-REQUIREMENT-L" />
						<linkTemplate name="LINK-IS-REQUIREMENT-OF" value="ID-REQUIREMENT-R" />
					</linkTemplates>
				</objectTemplate>
				<objectTemplate id="ID-CYLINDER-SURFACE">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-CYLINDER-SURFACE" value="true" />
						<attributeTemplate name="ATTRIBUTE-DIAMETER" />
						<attributeTemplate name="ATTRIBUTE-LENGTH" />
						<attributeTemplate name="ATTRIBUTE-HAS-LENGTH-REQUIREMENT" value="false"/>
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LINK-IS-PART-OF" value="ID-WORKPIECE" />
						<linkTemplate name="LINK-IS-LENGTH-REQUIREMENT" value="null" />
					</linkTemplates>
				</objectTemplate>
				<objectTemplate id="ID-REQUIREMENT-L">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-REQUIREMENT" value="true" />
						<attributeTemplate name="ATTRIBUTE-LENGTH-REQUIREMENT" />
						<attributeTemplate name="ATTRIBUTE-LENGTH-REQUIREMENT-STATUS" value="false" />
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LIST-IS-REQUIREMENT-OF" value="ID-WORKPIECE" />
						<linkTemplate name="LINK-SURFACE-SIDE-RIGHT" value="ID-REQUIREMENT-R" />
						<linkTemplate name="LINK-IS-LENGTH-REQUIREMENT" value="null" />
					</linkTemplates>
				</objectTemplate>
				<objectTemplate id="ID-REQUIREMENT-R">
					<attributeTemplates>
						<attributeTemplate name="ATTRIBUTE-REQUIREMENT" value="true" />
						<attributeTemplate name="ATTRIBUTE-DIAMETER-REQUIREMENT" />
						<attributeTemplate name="ATTRIBUTE-DIAMETER-REQUIREMENT-STATUS" value="false" />
					</attributeTemplates>
					<linkTemplates>
						<linkTemplate name="LINK-IS-REQUIREMENT-OF" value="ID-WORKPIECE" />
						<linkTemplate name="LINK-SURFACE-SIDE-LEFT" value="ID-REQUIREMENT-L" />
						<linkTemplate name="LINK-IS-DIAMETER-REQUIREMENT" value="null" />
					</linkTemplates>
				</objectTemplate>
			</objectTemplates>
		</systemTemplate>
		<transformations>
			<transformation type="attribute" objectId="ID-REQUIREMENT-L" attributeName="ATTRIBUTE-LENGTH-REQUIREMENT-STATUS" attributeValue="true" />
			<transformation type="attribute" objectId="ID-REQUIREMENT-R" attributeName="ATTRIBUTE-DIAMETER-REQUIREMENT-STATUS" attributeValue="true" />
			<transformation type="link" objectId="ID-CYLINDER-SURFACE" linkName="LINK-IS-LENGTH-REQUIREMENT" linkOldValue="null" linkNewValue="ID-REQUIREMENT-L" />
			<transformation type="link" objectId="ID-REQUIREMENT-L" linkName="LINK-IS-LENGTH-REQUIREMENT" linkOldValue="null" linkNewValue="ID-CYLINDER-SURFACE" />
			<transformation type="attribute" objectId="ID-CYLINDER-SURFACE" attributeName="ATTRIBUTE-HAS-LENGTH-REQUIREMENT" attributeValue="true" />
		</transformations>
		<action name="OPERATION-SPLIT-CYLINDER-SURFACE">
			<preConditionCheckers>
				<preConditionChecker>
					<script type="lua">
						<line n="1">local systemVariant = ...</line>
						<line n="2">local cylinderSurface_actual = systemVariant:getObjectByIdMatch('ID-CYLINDER-SURFACE')</line>
						<line n="3">local diameter = cylinderSurface_actual:getAttribute('ATTRIBUTE-DIAMETER'):getValueAsInteger()</line>
						<line n="4">local length = cylinderSurface_actual:getAttribute('ATTRIBUTE-LENGTH'):getValueAsInteger()</line>
						<line n="5">local requirement_l_actual = systemVariant:getObjectByIdMatch('ID-REQUIREMENT-L')</line>
						<line n="6">local lengthRequired = requirement_l_actual:getAttribute('ATTRIBUTE-LENGTH-REQUIREMENT'):getValueAsInteger()</line>
						<line n="7">local requirement_r_actual = systemVariant:getObjectByIdMatch('ID-REQUIREMENT-R')</line>
						<line n="8">local diameterRequired = requirement_r_actual:getAttribute('ATTRIBUTE-DIAMETER-REQUIREMENT'):getValueAsInteger()</line>
						<line n="9">return (diameter > diameterRequired) and (length > lengthRequired)</line>
					</script>
				</preConditionChecker>
			</preConditionCheckers>
			<parameterUpdaters>
				<parameterUpdater>
					<script type="lua">
						<line n="1">local systemVariant = ...</line>
						<line n="2">local cylinderSurface_actual = systemVariant:getObjectByIdMatch('ID-CYLINDER-SURFACE')</line>
						<line n="3">local diameter = cylinderSurface_actual:getAttribute('ATTRIBUTE-DIAMETER'):getValueAsInteger()</line>
						<line n="4">local length = cylinderSurface_actual:getAttribute('ATTRIBUTE-LENGTH'):getValueAsInteger()</line>
						<line n="5">local requirement_l_actual = systemVariant:getObjectByIdMatch('ID-REQUIREMENT-L')</line>
						<line n="6">local lengthRequired = requirement_l_actual:getAttribute('ATTRIBUTE-LENGTH-REQUIREMENT'):getValueAsInteger()</line>
						<line n="7">local requirement_r_actual = systemVariant:getObjectByIdMatch('ID-REQUIREMENT-R')</line>
						<line n="8">local diameterRequired = requirement_r_actual:getAttribute('ATTRIBUTE-DIAMETER-REQUIREMENT'):getValueAsInteger()</line>
						<line n="9">local workpiece_actual = systemVariant:getObjectByIdMatch('ID-WORKPIECE')</line>
						<line n="10">local diameterDelta = diameter - diameterRequired</line>
						<line n="11">systemVariant:setActionParameter('PARAMETER-DIAMETER-DELTA', diameterDelta)</line>
						<line n="12">local lengthDelta = length - lengthRequired</line>
						<line n="13">systemVariant:setActionParameter('PARAMETER-LENGTH-DELTA', lengthDelta)</line>
						<line n="14">local cylinderSurface_new = luajava.newInstance('planning.model.SystemObject', 'OBJECT-CYLINDER-SURFACE')</line>
						<line n="15">cylinderSurface_new:addAttribute('ATTRIBUTE-CYLINDER-SURFACE', true)</line>
						<line n="16">cylinderSurface_new:addAttribute('ATTRIBUTE-DIAMETER', diameterRequired)</line>
						<line n="17">cylinderSurface_new:addAttribute('ATTRIBUTE-LENGTH', lengthDelta)</line>
						<line n="18">cylinderSurface_new:addAttribute('ATTRIBUTE-HAS-DIAMETER-REQUIREMENT', true)</line>
						<line n="19">cylinderSurface_new:addAttribute('ATTRIBUTE-HAS-LENGTH-REQUIREMENT', false)</line>
						<line n="20">cylinderSurface_new:addLink('LINK-IS-PART-OF', workpiece_actual:getId())</line>
						<line n="21">cylinderSurface_new:addLink('LINK-IS-DIAMETER-REQUIREMENT', requirement_r_actual:getId())</line>
						<line n="22">cylinderSurface_new:addLink('LINK-IS-LENGTH-REQUIREMENT', nil)</line>
						<line n="23">cylinderSurface_new:addLink('LINK-SURFACE-SIDE-LEFT', cylinderSurface_actual:getId())</line>
						<line n="24">systemVariant:getSystem():addObject(cylinderSurface_new)</line>
						<line n="25">cylinderSurface_actual:getAttribute('ATTRIBUTE-LENGTH'):setValue(lengthRequired)</line>
						<line n="26">cylinderSurface_new:addLink('LINK-SURFACE-SIDE-RIGHT', cylinderSurface_new:getId())</line>
						<line n="27">workpiece_actual:addLink('LINK-IS-PART-OF', cylinderSurface_new:getId())</line>
						<line n="28">requirement_r_actual:getLink('LINK-IS-DIAMETER-REQUIREMENT', nil):setObjectId(cylinderSurface_new:getId())</line>
					</script>
				</parameterUpdater>
			</parameterUpdaters>
		</action>
	</systemTransformation>
</systemTransformations>
